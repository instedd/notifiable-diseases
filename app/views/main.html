<nd-reports-navbar></nd-reports-navbar>

<div class="row report" ng-show="currentReport">
  <div class="col-md-12">
    <h3>
      <a href="#" editable-text="currentReport.name">{{currentReport.name}}</a>
    </h3>
    <div>
      <a href="#" editable-textarea="currentReport.description" e-rows="4" e-cols="60">{{currentReport.description || 'No description'}}</a>
    </div>
  </div>
</div>

<div class="row">
  <!-- BEGIN: Filters panel -->
  <div id="filters" class="col-xs-5 col-sm-4 col-md-3" ng-controller="FiltersCtrl">
    <div class="well">
      <div class="row">
        <div class="col-md-6">
          <strong style="font-size:16px">Filters</strong>
        </div>
        <div class="col-md-6">
          <a class="pull-right" href="javascript:void(0)" ng-click="clearFilters()" ng-show="currentReport.filters.length > 0">
            Clear all
          </a>
        </div>
      </div>
      <hr/>
      <div class="row">
        <div class="col-md-12">
          <strong>All cases</strong>
          <span ng-show="hasCount(-1)">({{counts[-1]}})</span>
          <span ng-hide="hasCount(-1)">(...)</span>
        </div>
      </div>
      <div ng-repeat="filter in currentReport.filters">
        <hr/>
        <div class="row">
          <div class="col-md-12">
            <div style="padding-bottom:8px">
              <strong>{{ filter.description }}</strong>
              <span ng-show="hasCount($index)">({{counts[$index]}})</span>
              <span ng-hide="hasCount($index)">(...)</span>
              <a class="pull-right" href="javascript:void(0)" ng-click="$parent.removeFilterByIndex($index)">remove</a>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div ng-include src="filterTemplateFor(filter)"></div>
          </div>
        </div>
      </div>
      <hr/>
      <div>
        <a href="javascript:void(0);" ng-click="addNewFilterIsCollapsed = !addNewFilterIsCollapsed">Add new filter</a>
        <div collapse="addNewFilterIsCollapsed">
          <ul>
            <li><a href="javascript:void(0);" ng-click="addFilter('AgeGroupFilter')">Age group</a></li>
            <li><a href="javascript:void(0);" ng-click="addFilter('DateFilter')">Date</a></li>
            <li><a href="javascript:void(0);" ng-click="addFilter('EthnicityFilter')">Ethnicity</a></li>
            <li><a href="javascript:void(0);" ng-click="addFilter('GenderFilter')">Gender</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="javascript:void(0);" ng-click="duplicateReport()">Duplicate this report</a>
    <br/>
    <a href="javascript:void(0);" ng-click="deleteReport()">Delete this report</a>
  </div>
  <!-- END: Filters panel -->


  <!-- BEGIN: Charts -->
  <div class="col-xs-7 col-sm-8 col-md-9" ng-controller="ChartsCtrl">
    <div class="row">
      <div class="col-md-6" ng-repeat="chart in currentReport.charts">
        <div class='nd-trendline well' ng-controller="ChartCtrl" ng-init="chart=chart;report=currentReport" style="min-height:480px;max-height:480px">
          <div ng-hide="editingChart">
            <div>
              <span ng-show="chart.isConfigurable()">
                <a href="javascript:void(0)" ng-click="edit()">edit</a>
                |
              </span>
              <a href="javascript:void(0)" ng-csv="getCSV()" filename="{{getCSVFilename()}}">download csv</a>
            </div>
            <div>
              <a href="javascript:void(0)" ng-click="$parent.removeChartByIndex($index)">remove</a>
            </div>
            <div ng-include src="chartTemplateFor(chart)"></div>
          </div>
          <div ng-show="editingChart">
            <form ng-submit="saveChanges()">
              <div ng-include src="chartConfigTemplateFor(chart)"></div>
              <div style="margin-top:20px">
                <button class="btn btn-primary" ng-click="saveChanges()">Done</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="add-new-visualization">
          <a href="javascript:void(0);" ng-click="addNewChartIsCollapsed = !addNewChartIsCollapsed" class="add_new"></a>
          <div collapse="addNewChartIsCollapsed" class="chart_type">
              <div>
                <p>Select a chart type</p>
                <a href="javascript:void(0);" ng-click="addChart('Trendline')"><img src="images/ic-trendline.png"></a>
                <a href="javascript:void(0);" ng-click="addChart('PopulationPyramid')"><img src="images/ic-pyramid.png"></a>

              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- END: Charts -->
</div>
